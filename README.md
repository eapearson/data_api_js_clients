**Version: 0.1.0**

[![Build Status](https://travis-ci.org/dangunter/data_api_js_clients.svg)](https://travis-ci.org/dangunter/data_api_js_clients)
[![codecov.io](https://codecov.io/github/dangunter/data_api_js_clients/coverage.svg?branch=master)](https://codecov.io/github/dangunter/data_api_js_clients?branch=master)
![codecov.io](https://codecov.io/github/dangunter/data_api_js_clients/branch.svg?branch=master)

# JavaScript API Wrappers for the Data API

The JavaScript Data API is, like the Python API, custom wrapper code on top of the JavaScript library generated by Thrift. The source code for these wrappers is in `src/js/`.

## Download

### JS API repository

Get the repository from github using the `git clone` command (or some UI equivalent):

        git clone https://github.com/kbase/data_api_js_clients.git

### Core Data API repository
 
You will also need to check out a version of the data API 'core'. For right now, you should just check out the head of the development branch. Later, we will have tagged releases and you should check out a release that aligns with the version of this API. To future-proof the directory names, we will use a convention of `core-{tag_or_version}` for naming the cloned directory, so the command becomes the following:

    git clone -b develop https://github.com/kbase/data_api.git core-develop
    
For now it is recommended you use this directory name and clone the repository inside the top level of this repository. If you choose another location, you **must** modify the value of the variable `corepath` inside `Gruntfile.js` to your path. You also must substitute this directory wherever you see "core-develop" used in the examples below.

## Installation

In the following instructions, it will be assumed unless otherwise stated that the shell is currently operating from the top-level directory of the github repository, i.e. from the same directory in which you find this README. 

1. Change to the `core-{version}` directory for the core Data API repository.

     1a. Follow the instructions in the README for installation. This will include creating and activating a Python virtual environment. The scripts installed by this process will be used below to start the Data API Thrift services.

     1b. Important! Make sure you have checked out the git "submodule" that contains the test data. This will be
     required for running the JavaScript tests later.
     
         cd core-develop; git submodule init; git submodule update

2. Install/update JavaScript libraries. We use Node Package Manager (npm) and Bower.

    a. Change to the  directory and run the Node Package Manager (npm). 
    This downloads and installs a bunch of things, so it will take a couple of 
    minutes the first time, and create hundreds of lines of output.

        npm install

    If you have run `npm install` before, and there is nothing to do, you may just see a warning like "npm WARN package.json kbase-data-api-js@0.0.1 No repository field.". This is normal and harmless and you can ignore it.
    
4. Build JavaScript library. Repeat this step every time you make changes to the local code. This will also automatically run `bower update` for you.
    
        grunt build
    
    If this works, the last line of the Grunt output will say `Done, without errors.`
    
## Testing

All the JavaScript tests and tools, unless otherwise stated, should be run from the same directory as this README.

We use [Karma](https://karma-runner.github.io) to run the JavaScript code. Tests run against the following browsers/platforms:

    * chrome
    * safari  --- EEK! not working yet!!
    * firefox

The Karma configuration is under `test/karma.conf.js`. You shouldn't need to modify it, except perhaps for the "port:" setting if the default port conflicts with something else on your system.

Tests themselves are in `test/spec` and are usually named `test_<type>_api.js`, where "<type>" is the API name, e.g., `test_taxon_api.js`.

### Running the tests

For developer convenience, running local tests has been automated in a 'Makefile' in the
top-level directory. Run the command `make` to see available targets, and examine the
file contents to see how to modify and run the steps yourself.
    
### TravisCI

For development, we also use TravisCI. The configuration for the TravisCI tests is in the usual place, `.travis.yml` in the top-level directory. If any of the above steps don't work, you can look there and see if it's doing something different; if so, then that's probably the _real_ procedure and this document is out of date (please [report it](http://kbase.us/contact-us/) as a bug!).
